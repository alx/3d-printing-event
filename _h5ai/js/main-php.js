/*jslint browser: true, confusion: true, regexp: true, white: true */
(function(a){"use strict";var b={};(function(a,b){b.util=function(){var b=/^\/([^\/]+\/?)$/,c=/^(\/(?:.*\/)*?([^\/]+)\/)([^\/]+\/?)$/,d=function(a){var d;if(a==="/")return{parent:null,parentname:null,name:"/"};d=c.exec(a);if(d)return{parent:d[1],parentname:d[2],name:d[3]};d=b.exec(a);if(d)return{parent:"/",parentname:"/",name:d[1]}},e=/\/$/,f=function(a){return e.test(a)},g=function(b,c){var d,e,g;return f(b)||(b+="/"),c?(d=a(c).find("td").eq(1).find("a"),e=d.text()==="Parent Directory",g=d.attr("href"),e?undefined:b+g):b},h=1e3,i=/^\s*([\.\d]+)\s*([kmg]?)b?\s*$/i,j=function(a){var b=i.exec(a),c,d;return b?(c=parseFloat(b[1]),d=b[2].toLowerCase(),d==="k"?c*=h:d==="m"?c*=h*h:d==="g"?c*=h*h*h:d==="t"&&(c*=h*h*h*h),c):-1},k=["B","KB","MB","GB","TB"],l=function(a){var b=1e3,c=0,d=k.length-1;if(isNaN(a))return a;while(a>=b&&c<d)a/=h,c+=1;return(c<=1?Math.round(a):a.toFixed(1)).toString()+" "+k[c]},m=function(a){try{return decodeURI(a)}catch(b){}return a};return{splitPath:d,pathEndsWithSlash:f,getAbsHref:g,parseSize:j,formatSize:l,checkedDecodeUri:m}}()})(jQuery,b),function(a,b,c,d){c.core=function(){var e=b(a),f={store:{viewmode:"h5ai.pref.viewmode",lang:"h5ai.pref.lang"},callbacks:{pathClick:[]},rootAbsHref:"/",h5aiAbsHref:"/_h5ai/",customHeader:"_h5ai.header.html",customFooter:"_h5ai.footer.html",viewmodes:["details","icons"],sortorder:"na",showTree:!0,slideTree:!0,folderStatus:{},lang:null,useBrowserLang:!0,setParentFolderLabels:!0,linkHoverStates:!0,dateFormat:"yyyy-MM-dd HH:mm",showThumbs:!1,zippedDownload:!1},g=b.extend({},f,d.options),h=g.dateFormat,i=function(a){var c={};return b.each(a,function(a,d){b.each(d,function(b,d){c[d]=a})}),c}(d.types),j=function(){return g.h5aiAbsHref+"php/api.php"},k=function(a){return g.h5aiAbsHref+"images/"+a+".png"},l=function(a,b){return g.h5aiAbsHref+"icons/"+(b?"48x48":"16x16")+"/"+a+".png"},m=function(a){var c=b("#viewdetails"),d=b("#viewicons"),e=b("#extended");a?amplify.store(g.store.viewmode,a):a=amplify.store(g.store.viewmode),a=b.inArray(a,g.viewmodes)>=0?a:g.viewmodes[0],c.add(d).removeClass("current"),a==="details"?(c.addClass("current"),e.addClass("details-view").removeClass("icons-view").show()):a==="icons"?(d.addClass("current"),e.removeClass("details-view").addClass("icons-view").show()):e.hide()},n=function(){var a=b("body"),c=b("#tree"),d=function(){var d=e.height(),f=b("body > nav").outerHeight(),g=b("body > footer").outerHeight(),h=50,i=30;a.css({"margin-top":f+h,"margin-bottom":g+h}),c.css({top:f+i,height:d-f-g-18-2*i});try{c.get(0).updateScrollbar()}catch(j){}};e.resize(function(){d()}),d()},o=function(){var a=b("#navbar"),c=b("#extended");b("#table").remove(),g.viewmodes.length>1&&(b.inArray("icons",g.viewmodes)>=0&&b("<li id='viewicons' class='view'><a href='#'><img alt='view-icons' /><span class='l10n-icons'>icons</span></a></li>").find("img").attr("src",k("view-icons")).end().click(function(){m("icons")}).appendTo(a),b.inArray("details",g.viewmodes)>=0&&b("<li id='viewdetails' class='view'><a href='#'><img alt='view-details' /><span class='l10n-details'>details</span></a></li>").find("img").attr("src",k("view-details")).end().click(function(){m("details")}).appendTo(a)),c.find(".entry a").hover(function(){if(c.hasClass("icons-view")){var a=b(this);b(".status.default").hide(),b(".status.dynamic").empty().append(a.find(".label").clone()).append(b("<span class='sep'>·</span>")).append(a.find(".date").clone()).show(),a.closest(".entry").hasClass("folder")||b(".status.dynamic").append(b("<span class='sep'>·</span>")).append(a.find(".size").clone())}},function(){b(".status.default").show(),b(".status.dynamic").empty().hide()})},p=function(a,c){var d=b("#tree"),e=b("#extended");g.slideTree&&d.outerWidth()<e.offset().left||a?c?d.stop().css({left:0}):d.stop().animate({left:0}):c?d.stop().css({left:18-d.outerWidth()}):d.stop().animate({left:18-d.outerWidth()})},q=function(){b("#tree").hover(function(){p(!0)},function(){p()}),e.resize(function(){p()}),p(!1,!0)},r=function(a){var c=[];return b("a[href^='/']").each(function(){b(this).attr("href")===a&&c.push(this)}),b(c)},s=function(){g.linkHoverStates&&b("a[href^='/']:not(.linkedHoverStates)").each(function(){var a=b(this).addClass("linkedHoverStates"),c=a.attr("href");a.hover(function(){r(c).addClass("hover")},function(){r(c).removeClass("hover")})})},t=function(a){a&&(h=a),b("#extended .entry .date").each(function(){var a=b(this),c=a.data("time"),d=c?(new Date(c)).toString(h):"";a.text(d)})},u=function(a,c,d){var e=amplify.store(g.store.lang),f,h,i;a[e]?c=e:d&&(f=navigator.language,a[f]?c=f:f.length>2&&a[f.substr(0,2)]&&(c=f.substr(0,2))),a[c]||(c="en"),h=a[c],h&&(b.each(h,function(a,c){b(".l10n-"+a).text(c)}),b(".lang").text(c),b(".langOption").removeClass("current"),b(".langOption."+c).addClass("current")),t(h.dateFormat||g.dateFormat)},v=function(a){var c=b("#langSelector .langOptions"),d=[],e;b.each(a,function(a){d.push(a)}),d.sort(),e=b("<ul />"),b.each(d,function(c,d){b("<li class='langOption' />").addClass(d).text(d+" - "+a[d].lang).appendTo(e).click(function(){amplify.store(g.store.lang,d),u(a,d,!1)})}),c.append(e).scrollpanel(),b("#langSelector").hover(function(){c.css("top","-"+c.outerHeight()+"px").stop(!0,!0).fadeIn(),c.get(0).updateScrollbar()},function(){c.stop(!0,!0).fadeOut()})},w=function(a){var c=b(this),d=c.closest(".entry"),e=b("#tree").get(0).updateScrollbar;c.hasClass("unknown")?b.get(j(),{action:"tree",href:d.find("> a").attr("href")},function(a){var f=b(a);c.removeClass("unknown"),f.find("> li").size()===0?c.replaceWith(b("<span class='blank' />")):(c.addClass("open"),d.find("> .content").replaceWith(f),e(),f.find(".indicator:not(.initiated)").click(w).addClass("initiated"))}):c.hasClass("open")?(c.removeClass("open"),e(!0),d.find("> .content").slideUp(function(){e()})):(c.addClass("open"),e(!0),d.find("> .content").slideDown(function(){e()}))},x=function(){b("#tree .entry.folder .indicator:not(.initiated)").click(w).addClass("initiated")},y=function(a){var b=a.lastIndexOf("."),c=b>=0?a.substr(b):a;return i[c.toLowerCase()]||"unknown"},z=function(){b("#extended .entry .size").each(function(){var a=b(this),d=a.data("bytes"),e=d>=0?c.util.formatSize(d):"";a.text(e)})},A=function(){var a=b("#extended");b(".folderTotal").text(a.find(".entry.folder:not(.folder-parent)").length),b(".fileTotal").text(a.find(".entry.file").length)},B=function(){o(),m(),n(),q(),s(),v(d.langs),u(d.langs,g.lang,g.useBrowserLang),z(),A(),x()};return{settings:g,api:j,image:k,icon:l,shiftTree:p,linkHoverStates:s,initIndicators:x,formatDates:t,getFileType:y,init:B}}()}(window,jQuery,b,H5AI_CONFIG),function(a,b){b.sort=function(){var c=function(b){var c=a(b);return c.hasClass("folder-parent")?0:c.hasClass("folder")?1:2},d=function(a,b,d,e){var f,g,h;return f=c(a)-c(b),f!==0?f:(g=e(a),h=e(b),g<h?d?1:-1:g>h?d?-1:1:0)},e=function(b,c){return d(b,c,!1,function(b){return a(b).find(".label").text().toLowerCase()})},f=function(b,c){return d(b,c,!1,function(b){return a(b).find(".date").data("time")})},g=function(b,c){return d(b,c,!1,function(b){return a(b).find(".size").data("bytes")})},h=function(b,c){return d(b,c,!0,function(b){return a(b).find(".label").text().toLowerCase()})},i=function(b,c){return d(b,c,!0,function(b){return a(b).find(".date").data("time")})},j=function(b,c){return d(b,c,!0,function(b){return a(b).find(".size").data("bytes")})},k=function(b){a("#extended .entry").detach().sort(b).appendTo(a("#extended > ul"))},l,m,n=function(a){var b=m[a];l.removeClass("ascending").removeClass("descending"),b.head.addClass(b.clas).attr("href","#!/sort="+a),k(b.fn)},o=function(){var c=a("<img src='"+b.core.image("ascending")+"' class='sort ascending' alt='ascending' />"),d=a("<img src='"+b.core.image("descending")+"' class='sort descending' alt='descending' />"),k=/^.*#!.*\/sort=(.*?)(?:\/.*)?$/.exec(document.location),o=a("#extended li.header"),p=o.find("a.label"),q=o.find("a.date"),r=o.find("a.size");l=o.find("a.label,a.date,a.size"),m={na:{head:p,clas:"ascending",fn:e},nd:{head:p,clas:"descending",fn:h},da:{head:q,clas:"ascending",fn:f},dd:{head:q,clas:"descending",fn:i},sa:{head:r,clas:"ascending",fn:g},sd:{head:r,clas:"descending",fn:j}},n(k?k[1]:b.core.settings.sortorder),p.attr("href","#!/sort=na").append(c.clone()).append(d.clone()).click(function(){n("n"+(p.hasClass("ascending")?"d":"a"))}),q.attr("href","#!/sort=da").prepend(c.clone()).prepend(d.clone()).click(function(){n("d"+(q.hasClass("ascending")?"d":"a"))}),r.attr("href","#!/sort=sa").prepend(c.clone()).prepend(d.clone()).click(function(){n("s"+(r.hasClass("ascending")?"d":"a"))})};return{init:o}}()}(jQuery,b),function(a,b){b.zippedDownload=function(){var c=0,d=0,e=a(document),f=a("#selection-rect"),g=function(){var c=a("#extended a.selected"),d=a("#download"),e,f;c.size()>0?(c.each(function(){f=a(this).attr("href"),e=e?e+":"+f:f}),e=b.core.api()+"?action=zip&hrefs="+e,d.show().find("a").attr("href",e)):d.hide().find("a").attr("href","#")},h=function(b){var e=Math.min(c,b.pageX),g=Math.min(d,b.pageY),h=Math.abs(c-b.pageX),i=Math.abs(d-b.pageY),j;b.preventDefault(),f.css({left:e,top:g,width:h,height:i}),j=f.fracs("rect"),a("#extended a").removeClass("selecting").each(function(){var b=a(this),c=b.fracs("rect"),d=j.intersection(c);d&&!b.closest(".entry").hasClass("folder-parent")&&b.addClass("selecting")})},i=function(b){b.preventDefault(),e.off("mousemove",h),f.hide().css({left:0,top:0,width:0,height:0}),a("#extended a.selecting.selected").removeClass("selecting").removeClass("selected"),a("#extended a.selecting").removeClass("selecting").addClass("selected"),g()},j=function(b){var j=a.fracs.viewport();c=b.pageX,d=b.pageY;if(b.button!==0||c>=j.right||d>=j.bottom)return;b.preventDefault(),b.ctrlKey||(a("#extended a").removeClass("selected"),g()),f.show().css({left:c,top:d,width:0,height:0}),h(b),e.on("mousemove",h).one("mouseup",i)},k=function(a){return a.stopPropagation(),!1},l=function(a){a.ctrlKey||k(a)},m=function(){b.core.settings.zippedDownload&&(a("<li id='download'><a href='#'><img alt='download' /><span class='l10n-download'>download</span></a></li>").find("img").attr("src",b.core.image("download")).end().appendTo(a("#navbar")),a("body>nav,body>footer,#tree").on("mousedown",k),a("#extended").on("mousedown","a",l),e.on("mousedown",j))};return{init:m}}()}(jQuery,b),a(function(){b.core.init(),b.sort.init(),b.zippedDownload.init(),a("#tree").scrollpanel(),b.core.shiftTree(!1,!0)})})(jQuery)